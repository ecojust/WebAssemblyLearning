<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>WebAssemblyLearning</title>
</head>
<body>
    
</body>
<script>
    function utf8ToString(p) {
        let h = new Uint8Array(imports.env.memory.buffer);
        let s = "";
        for (let i = p; h[i]; i++) {
            s += String.fromCharCode(h[i]);
        }
        return s;
    };
    var importObject = { imports: { i: arg => console.log(arg) } };

    var imports = {
        env: {
            // 内存空间
            memoryBase: 0,
            memory: new WebAssembly.Memory({initial: 256 }),
            // 变量映射表
            tableBase: 0,
            table: new WebAssembly.Table({initial: 0, element: "anyfunc" }),
            // 注入函数
            _alert: function (p) {
                // 这一块说明请看文章
                alert(utf8ToString(p));
            }
        }
    };
    // fetch("a.out.wasm").
    //    then(response => response.arrayBuffer()).
    //    then(bytes => WebAssembly.instantiate(bytes, importObject)).
    //    then(mod => mod.instance).
    //    then(instance => {
    //        console.log(instance)
    //    });
</script>
<script src="a.out.js"></script>
</html>